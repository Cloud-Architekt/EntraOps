{
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workbookDisplayName": {
            "type": "string",
            "defaultValue": "EntraOps Privileged EAM - Overview",
            "metadata": {
                "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
            }
        },
        "workbookType": {
            "type": "string",
            "defaultValue": "workbook",
            "metadata": {
                "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
            }
        },
        "workbookSourceId": {
            "type": "string",
            "defaultValue": "azure active directory",
            "metadata": {
                "description": "The id of resource instance to which the workbook will be associated"
            }
        },
        "workbookId": {
            "type": "string",
            "defaultValue": "[newGuid()]",
            "metadata": {
                "description": "The unique guid for this workbook instance"
            }
        }
    },
    "resources": [
        {
            "name": "[parameters('workbookId')]",
            "type": "microsoft.insights/workbooks",
            "location": "[resourceGroup().location]",
            "apiVersion": "2022-04-01",
            "dependsOn": [],
            "kind": "shared",
            "properties": {
                "displayName": "[parameters('workbookDisplayName')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"parameters\":[{\"id\":\"4666895c-a22c-4fad-be1c-a8d31c4383d9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectLogAnalytics\",\"label\":\"Select Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"resources\\r\\n| where type == \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| project id\",\"crossComponentResources\":[\"value::selected\"],\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":null},{\"id\":\"cd33301b-949e-4159-bd9d-daf07a2eea28\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"RoleSystem\",\"label\":\"RBAC System\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"PrivilegedEAM\\r\\n| distinct RoleSystem\\r\\n| summarize Count = count() by RoleSystem\\r\\n| order by Count desc, RoleSystem asc\\r\\n| project Value = RoleSystem\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"typeSettings\":{\"limitSelectTo\":10,\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]},{\"id\":\"fdb99e3a-478f-4382-b4f4-204c38bc81a9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AdminTierLevelName\",\"label\":\"RBAC Tier Level\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"PrivilegedEAM\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| mv-expand (parse_json(Classification))\\r\\n| where tostring(Classification.AdminTierLevel) != \\\"\\\" and tostring(Classification.AdminTierLevelName) != \\\"\\\"\\r\\n| distinct tostring(Classification.AdminTierLevel), tostring(Classification.AdminTierLevelName)\\r\\n| order by Classification_AdminTierLevel asc\\r\\n| project Value = Classification_AdminTierLevelName\\r\\n\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]},{\"id\":\"899df38d-0db6-4aec-991f-f3d885c14677\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Service\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"PrivilegedEAM\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| extend Classification = parse_json(Classification)\\r\\n| mv-expand Classification\\r\\n| where Classification.AdminTierLevelName in ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| extend Service = tostring(Classification.Service)\\r\\n| distinct Service\\r\\n| order by Service asc\\r\\n| project Value = tostring(Service)\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"typeSettings\":{\"limitSelectTo\":10,\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"a7278d5a-1e2f-4eef-a7fc-8b9b4f97e2f8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ObjectType\",\"label\":\"Principal Type\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"PrivilegedEAM\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| extend Classification = parse_json(Classification)\\r\\n| mv-expand Classification\\r\\n| where Classification.AdminTierLevelName in ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| distinct ObjectType\\r\\n| order by ObjectType asc\\r\\n| project Value = tostring(ObjectType)\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]},{\"id\":\"8eafa332-2a5b-43dd-90c6-b9d1d12ad033\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"PrincipalDisplayName\",\"label\":\"Principal DisplayName\",\"type\":1,\"value\":\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PrivilegedEAM\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| extend Roles = parse_json(RoleAssignments)\\r\\n| extend Classification = parse_json(Classification)\\r\\n| mv-expand Classification\\r\\n| where Classification.AdminTierLevelName in ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| where Classification.Service in ({Service}) or '*' in ({Service})\\r\\n| where ObjectType in ({ObjectType}) or '*' in ({ObjectType})\\r\\n| distinct ObjectId, ObjectType, OnPremSynchronized, ObjectDisplayName, TimeGenerated\\r\\n| where ObjectDisplayName contains '{PrincipalDisplayName}' or '{PrincipalDisplayName}' == \\\"\\\"\\r\\n| extend SyncSource = iff(OnPremSynchronized == \\\"False\\\",\\\"Cloud-Only\\\",\\\"Hybrid\\\")\\r\\n| summarize Count = count() by SyncSource\\r\\n| join kind = fullouter (datatable(SyncSource:string)['Cloud-Only', 'Hybrid']) on SyncSource\\r\\n| project SyncSource = iff(SyncSource == '', SyncSource1, SyncSource), Count = iff(SyncSource == '', 0, Count)\",\"size\":4,\"title\":\"Sync source of privileged identities\",\"timeContext\":{\"durationMs\":604800000},\"exportFieldName\":\"SyncSource\",\"exportParameterName\":\"SyncSource\",\"exportDefaultValue\":\"*\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"visualization\":\"tiles\",\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SyncSource\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":1},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"Synchronized Privileged Accounts\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PrivilegedEAM\\r\\n| where OnPremSynchronized == iff('{SyncSource}' == \\\"Cloud-Only\\\",false,true) or '{SyncSource}' == '*' or '{SyncSource}' == 'All Privileged Identities'\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| where Classification contains ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| where Classification contains ({Service}) or '*' in ({Service})\\r\\n| where ObjectType in ({ObjectType}) or '*' in ({ObjectType})\\r\\n| mv-expand parse_json(RoleAssignments)\\r\\n| extend AssignmentType =  strcat(RoleAssignments.RoleAssignmentType, \\\" \\\", RoleAssignments.PIMAssignmentType)\\r\\n| summarize count() by AssignmentType\\r\\n| sort by count_\",\"size\":4,\"title\":\"Assignments of privileged roles\",\"timeContext\":{\"durationMs\":604800000},\"exportFieldName\":\"AssignmentType\",\"exportParameterName\":\"AssignmentType\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"OnPremSynchronized\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"RestrictedManagement\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Role Assignments\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PrivilegedEAM\\r\\n| where ObjectType != \\\"group\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by ObjectId, RoleSystem\\r\\n| where OnPremSynchronized == iff('{SyncSource}' == \\\"Cloud-Only\\\",False,True) or '{SyncSource}' == '*' or '{SyncSource}' == 'All Privileged Identities'\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| extend Roles = parse_json(RoleAssignments)\\r\\n| extend Classification = parse_json(Classification)\\r\\n| mv-expand Classification\\r\\n| where Classification.AdminTierLevelName in ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| where Classification.Service in ({Service}) or '*' in ({Service})\\r\\n| where ObjectType in ({ObjectType}) or '*' in ({ObjectType})\\r\\n| where ObjectDisplayName contains '{PrincipalDisplayName}' or '{PrincipalDisplayName}' == \\\"\\\"\\r\\n| distinct ObjectId, ObjectAdminTierLevelName\\r\\n| summarize Count = count() by ObjectAdminTierLevelName\\r\\n| join kind = fullouter (datatable(ObjectAdminTierLevelName:string)['ControlPlane', 'ManagementPlane','WorkloadPlane','UserAccess','Unclassified']) on ObjectAdminTierLevelName\\r\\n| project ObjectAdminTierLevelName = iff(ObjectAdminTierLevelName == '', ObjectAdminTierLevelName1, ObjectAdminTierLevelName), Count = iff(ObjectAdminTierLevelName == '', 0, Count)\\r\\n| sort by ObjectAdminTierLevelName asc\",\"size\":4,\"title\":\"Classification of privileged identities\",\"timeContext\":{\"durationMs\":604800000},\"exportFieldName\":\"ObjectAdminTierLevelName\",\"exportParameterName\":\"ObjectAdminTierLevelName\",\"exportDefaultValue\":\"*\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ObjectAdminTierLevelName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"ObjectAdminTierLevelName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Classifications Privileged Accounts \",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PrivilegedEAM\\r\\n| where OnPremSynchronized == iff('{SyncSource}' == \\\"Cloud-Only\\\",False,True) or '{SyncSource}' == '*' or '{SyncSource}' == 'All Privileged Identities'\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| extend Roles = parse_json(RoleAssignments)\\r\\n| extend Classification = parse_json(Classification)\\r\\n| mv-expand Classification\\r\\n| where Classification.AdminTierLevelName in ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| where Classification.Service in ({Service}) or '*' in ({Service})\\r\\n| where ObjectType in ({ObjectType}) or '*' in ({ObjectType})\\r\\n| where ObjectDisplayName contains '{PrincipalDisplayName}' or '{PrincipalDisplayName}' == \\\"\\\"\\r\\n| where ObjectAdminTierLevelName contains '{ObjectAdminTierLevelName}' or '{ObjectAdminTierLevelName}' == \\\"*\\\"\\r\\n| sort by ObjectAdminTierLevelName asc\\r\\n| distinct ObjectId, RoleClassificationAdminTierLevelName = tostring(Classification.AdminTierLevelName)\\r\\n| summarize Count = count() by RoleClassificationAdminTierLevelName\\r\\n| join kind = fullouter (datatable(RoleClassificationAdminTierLevelName:string)['ControlPlane', 'ManagementPlane','WorkloadPlane','UserAccess','Unclassified']) on RoleClassificationAdminTierLevelName\\r\\n| project RoleClassificationAdminTierLevelName = iff(RoleClassificationAdminTierLevelName == '', RoleClassificationAdminTierLevelName1, RoleClassificationAdminTierLevelName), Count = iff(RoleClassificationAdminTierLevelName == '', 0, Count)\",\"size\":4,\"title\":\"Classification of privileged access\",\"timeContext\":{\"durationMs\":604800000},\"exportFieldName\":\"RoleClassificationAdminTierLevelName\",\"exportParameterName\":\"RoleClassificationAdminTierLevelName\",\"exportDefaultValue\":\"*\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"RoleClassificationAdminTierLevelName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"ObjectAdminTierLevelName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Classifications Privileged Access\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PrivilegedEAM\\r\\n| where RoleSystem in ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| extend Roles = parse_json(RoleAssignments)\\r\\n| extend Classification = parse_json(Classification)\\r\\n| where ObjectDisplayName contains '{PrincipalDisplayName}' or '{PrincipalDisplayName}' == \\\"\\\"\\r\\n| where Classification contains ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| where Classification contains ({Service}) or '*' in ({Service})\\r\\n| where ObjectType in ({ObjectType}) or '*' in ({ObjectType})\\r\\n| where OnPremSynchronized == iff('{SyncSource}' == \\\"Cloud-Only\\\",False,True) or '{SyncSource}' == '*' or '{SyncSource}' == 'All Privileged Identities'\\r\\n| extend OnPremSynchronized = iff(OnPremSynchronized == \\\"False\\\",\\\"Cloud-Only\\\",\\\"Hybrid\\\")\\r\\n| where ObjectAdminTierLevelName == '{ObjectAdminTierLevelName}' or '*' == '{ObjectAdminTierLevelName}'\\r\\n| where parse_json(Classification) contains '{RoleClassificationAdminTierLevelName}' or '*' == '{RoleClassificationAdminTierLevelName}'\\r\\n| extend RestrictedManagement = bag_pack_columns(RestrictedManagementByAadRole, RestrictedManagementByRAG, RestrictedManagementByRMAU)\\r\\n| summarize RoleSystem = make_set(RoleSystem) by ObjectId, ObjectType, ObjectSubType, ObjectDisplayName, OnPremSynchronized, AssignedAdministrativeUnits, tostring(RestrictedManagement)\\r\\n| sort by ObjectDisplayName\",\"size\":0,\"title\":\"List of Privileged Accounts \",\"timeContext\":{\"durationMs\":604800000},\"exportFieldName\":\"ObjectId\",\"exportParameterName\":\"ObjectId\",\"exportDefaultValue\":\"*\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ObjectDisplayName\",\"formatter\":0,\"tooltipFormat\":{\"tooltip\":\"{ObjectUserPrincipalName}\"}},{\"columnMatch\":\"Group\",\"formatter\":1},{\"columnMatch\":\"ObjectAdminTierLevel_s\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Unclassified\",\"representation\":\"1\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ControlPlane\",\"representation\":\"Sev0\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ManagementPlane\",\"representation\":\"Sev2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"unknown\",\"text\":\"{0}{1}\"}]}}],\"sortBy\":[{\"itemKey\":\"ObjectId\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"ObjectId\",\"sortOrder\":1}]},\"name\":\"Related Privileged Accounts \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PrivilegedEAM\\r\\n| where ObjectId == '{ObjectId}' or '{ObjectId}' == '*'\\r\\n| where RoleSystem contains ({RoleSystem}) or '*' in ({RoleSystem})\\r\\n| extend Roles = parse_json(RoleAssignments)\\r\\n| extend Classification = parse_json(Classification)\\r\\n| where ObjectDisplayName contains '{PrincipalDisplayName}' or '{PrincipalDisplayName}' == \\\"\\\"\\r\\n| where Classification contains ({AdminTierLevelName}) or '*' in ({AdminTierLevelName})\\r\\n| where Classification contains ({Service}) or '*' in ({Service})\\r\\n| where ObjectType in ({ObjectType}) or '*' in ({ObjectType})\\r\\n| where OnPremSynchronized == iff('{SyncSource}' == \\\"Cloud-Only\\\",False,true) or '{SyncSource}' == '*' or '{SyncSource}' == 'All Privileged Identities'\\r\\n| extend OnPremSynchronized = iff(OnPremSynchronized == \\\"False\\\",\\\"Cloud-Only\\\",\\\"Hybrid\\\")\\r\\n| where ObjectAdminTierLevelName == '{ObjectAdminTierLevelName}' or '*' == '{ObjectAdminTierLevelName}'\\r\\n| where parse_json(Classification) contains '{RoleClassificationAdminTierLevelName}' or '*' == '{RoleClassificationAdminTierLevelName}'\\r\\n| mv-expand RoleAssignments\\r\\n| project RoleAssignments, RoleSystem\\r\\n| evaluate bag_unpack(RoleAssignments)\\r\\n| extend Classification = column_ifexists(\\\"Classification\\\",\\\"\\\")\\r\\n| mv-expand parse_json(Classification)\\r\\n| extend AdminTierLevel = Classification.AdminTierLevelName\\r\\n| extend Service = Classification.Service\\r\\n| extend TaggedBy = Classification.TaggedBy\\r\\n| where Service contains ('*') or '*' in ('*')\\r\\n| extend TransitiveBy = column_ifexists(\\\"TransitiveByObjectDisplayName\\\", \\\"\\\")\\r\\n| summarize AdminTierLevels = make_set(AdminTierLevel), Service = make_set(Service) by\\r\\n    RoleSystem,\\r\\n    tostring(RoleAssignmentId),\\r\\n    RoleDefinitionName,\\r\\n    tostring(RoleAssignmentScopeId),\\r\\n    RoleAssignmentScopeName,\\r\\n    PIMManagedRole,\\r\\n    PIMAssignmentType,\\r\\n    RoleAssignmentType,\\r\\n    TransitiveBy,\\r\\n    tostring(TaggedBy)\\r\\n| extend AdminTierLevel = iff(isnotempty(AdminTierLevels[0]), AdminTierLevels[0], \\\"Unclassified\\\")\\r\\n| sort by tostring(AdminTierLevel) asc, tostring(RoleAssignmentScopeId) asc, RoleDefinitionName asc\\r\\n| project-reorder RoleSystem, AdminTierLevel, RoleDefinitionName, RoleAssignmentScopeName, PIMAssignmentType, RoleAssignmentType, TransitiveBy, PIMManagedRole, Service\",\"size\":0,\"title\":\"Related privileged role assignments\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{SelectLogAnalytics}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"RoleAssignmentType\",\"formatter\":0,\"tooltipFormat\":{\"tooltip\":\"[\\\"TransitiveByObjectDisplayName\\\"]\"}},{\"columnMatch\":\"RoleAssignmentScopeId\",\"formatter\":0,\"tooltipFormat\":{\"tooltip\":\"[\\\"RoleAssignmentScopeName\\\"]\"}}],\"sortBy\":[{\"itemKey\":\"RoleSystem\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"RoleSystem\",\"sortOrder\":1}]},\"name\":\"Related privileged role assignments\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"azure active directory\"]}",
                "version": "1.0",
                "sourceId": "[parameters('workbookSourceId')]",
                "category": "[parameters('workbookType')]"
            }
        }
    ],
    "outputs": {
        "workbookId": {
            "type": "string",
            "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
        }
    },
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}